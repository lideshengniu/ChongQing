import{a9 as e,aa as a,_ as t,y as n,M as l,r as o,p as i,Y as s,aj as c,a as d,b as r,d as u,P as p,H as h,a0 as g,K as f,G as m,R as y,ak as v,F as b,aq as x,ar as w,ab as k,as as C,a3 as S,a4 as _,ad as G,A as T,u as E}from"./index.3e972bdf.js";import{k as O}from"./kml-geojson-src.9e222f93.js";import{u as U}from"./use-lifecycle.fdbeda11.js";let A,D;const N=new e.exports.BaseClass;console.log("LayerType",e.exports.LayerType);const H={fxaa:!0,globe:{depthTestAgainstTerrain:!0}};function L(){D.startDraw({type:"viewShed",style:{angle:60,angle2:45,distance:80,heading:44,pitch:-12}})}function P({data:e}){console.log(e,"datadata"),D.startDraw({type:"viewShed",style:{angle:e.style.angle1,angle2:e.style.angle2,distance:80,heading:44,pitch:-12}})}function j(a){D.clear(),D.enabledEvent=!1;const t=e.exports.PolyUtil.getGridPoints([116.984788,31.625909,117.484068,32.021504],a,30);console.log("生成的测试网格坐标",t);for(let n=0;n<t.points.length;++n){const a=t.points[n],l=n+1,o=new e.exports.graphic.ViewShed({position:a,style:{angle:60,angle2:45,distance:1880,heading:44,pitch:-12,addHeight:2},attr:{index:l}});D.addGraphic(o)}return D.enabledEvent=!0,t.points.length}let V;function F(e){return V=D.getGraphicById(e),V}function J(){V&&A.graphicLayer.startDraw({type:"point",success:e=>{const a=e.point;e.remove(),V.position=a}})}function M(e){V&&(V.angle=e)}function I(e){V&&(V.angle2=e)}function R(e){V&&(V.distance=e)}function $(e){V&&(V.addHeight=e)}function z(e){V&&(V.heading=e)}function B(e){V&&(V.pitch=e)}function W(e){V&&(V.showFrustum=e)}function K(e){V&&(V.opacity=e)}function Y(){V&&A.graphicLayer.startDraw({type:"point",success:e=>{const a=e.point;e.remove(),V.targetPosition=a}})}function q(){return D}function Q(){D.startDraw({type:"fineArrowYW",style:{color:"#ff0000",opacity:.6,outline:!0,outlineWidth:3,outlineColor:"#ffffff",clampToGround:!0}})}var X=Object.freeze(Object.defineProperty({__proto__:null,get map(){return A},get graphicLayer(){return D},eventTarget:N,onMounted:function(a){A=a,console.log(A.camera.direction,"camera"),A.setSceneOptions(H),D=new e.exports.layer.GraphicLayer,A.addLayer(D)},onUnmounted:function(){D.remove(!0),A=null},startDrawGraphic:L,start3DrawGraphic:P,addDrawGraphic:function(a,t,n){const l=new e.exports.graphic.ViewShed({position:t,style:{angle:60,angle2:45,distance:2e3,heading:44,pitch:-12,addHeight:10},name:`${n}`});a.addGraphic(l),console.log(n,"iiiiiiiiiii")},addDemoGraphic:function(a,t,n){const l=new e.exports.graphic.DivBoderLabel({position:t,style:{text:`point${n}`,font_size:15,font_family:"微软雅黑",color:"#ccc",boderColor:"#15d1f2",clampToGround:!0},attr:{remark:"示例6"}});a.addGraphic(l)},addRandomGraphicByCount:j,getGraphic:F,selCamera:J,onChangeAngle:M,onChangeAngle2:I,onChangeDistance:R,onChangeaddHeight:$,onChangeHeading:z,onChangePitch:B,showFrustum:W,onChangeOpacity:K,onClickSelView:Y,getManagerLayer:q,startDrawGraphic2:Q,bindLayerPopup:function(){D.bindPopup((function(a){const t=a.graphic.attr||{};return t["类型"]=a.graphic.type,t["来源"]="我是layer上绑定的Popup",t["备注"]="我支持鼠标交互",e.exports.Util.getTemplateHtml({title:"矢量图层",template:"all",attr:t})}))},bindLayerContextMenu:function(){D.bindContextMenu([{text:"开始编辑对象",icon:"fa fa-edit",show:function(e){const a=e.graphic;return!(!a||!a.hasEdit)&&!a.isEditing},callback:e=>{const a=e.graphic;if(!a)return!1;a&&D.startEditing(a)}},{text:"停止编辑对象",icon:"fa fa-edit",show:function(e){const a=e.graphic;return!(!a||!a.hasEdit)&&a.isEditing},callback:e=>{const a=e.graphic;if(!a)return!1;a&&a.stopEditing()}},{text:"删除对象",icon:"fa fa-trash-o",show:e=>{const a=e.graphic;return!(!a||a.isDestroy)},callback:e=>{const a=e.graphic;if(!a)return;const t=a.parent;D.removeGraphic(a),t&&D.removeGraphic(t)}},{text:"计算周长",icon:"fa fa-medium",callback:t=>{const n=t.graphic,l=e.exports.MeasureUtil.formatDistance(n.distance);a("该对象的周长为:"+l)}},{text:"计算面积",icon:"fa fa-reorder",callback:t=>{const n=t.graphic,l=e.exports.MeasureUtil.formatArea(n.area);a("该对象的面积为:"+l)}}])},onchoose:function({data:e}){V&&(console.log("xxxs",e),V.angle=e.style.angle1,V.angle2=e.style.angle2)}},Symbol.toStringTag,{value:"Module"}));const Z=e=>(S("data-v-48fdd9f5"),e=e(),_(),e),ee={class:"f-mb"},ae=Z((()=>u("span",{class:"mars-pannel-item-label"},"图层状态:",-1))),te={key:0,class:"mars-pannel-item-label",title:"不是所有矢量数据均支持修改全局透明度"},ne={key:0,class:"f-mb"},le=Z((()=>u("span",{class:"mars-pannel-item-label"},"数据维护:",-1))),oe={class:"f-mb"},ie=Z((()=>u("span",null,"数据测试:",-1))),se={class:"f-mb"},ce=Z((()=>u("span",{class:"mars-pannel-item-label"},"方案选择:",-1))),de={class:"f-mb"},re=Z((()=>u("span",{class:"mars-pannel-item-label"},"数据导出:",-1))),ue={class:"f-mb data-list"};var pe=t(n({__name:"index",props:{interaction:{type:Boolean,default:!0},enabledDraw:{type:Boolean,default:!0},drawLabel1:{default:"图上标绘"},drawLabel2:{default:void 0},defaultCount:{default:100},customEditor:{default:""}},emits:["onStartEditor","onStopEditor","choose"],setup(a,{emit:t}){const n=a;U(X);const S=l({enabledShowHide:!0,enabledPopup:!0,enabledTooltip:!1,enabledRightMenu:!1,enabledOpacity:!0,opacity:1,enabledEdit:!0,hasEdit:!1,hasTable:!1,count:n.defaultCount}),_=[{value:"fangan1",label:"方案1",style:{angle1:15,angle2:15}},{value:"fangan2",label:"方案2",style:{angle1:30,angle2:30}},{value:"fangan3",label:"方案3",style:{angle1:60,angle2:45}}],G=o(5);function T(){return q?q():D}i((()=>{N&&N.on("defuatData",(e=>{S.opacity=1,S.enabledShowHide=e.enabledShowHide,S.enabledPopup=e.enabledPopup,S.enabledTooltip=e.enabledTooltip,S.enabledRightMenu=e.enabledRightMenu})),setTimeout((()=>{const e=T();if(console.log(e,"layer"),e){S.enabledShowHide=e.show,S.enabledPopup=e.hasPopup(),S.enabledTooltip=e.hasTooltip(),S.enabledRightMenu=e.hasContextMenu();const a=e.getGraphics();if(a.length>0){const e=a[a.length-1];S.enabledOpacity=e.hasOpacity,S.enabledEdit=e.hasEdit}S.hasTable=!0}}),500)}));const E=e=>{G.value=e.pageSize},A=()=>{T().opacity=S.opacity},H=(e,a)=>{t("choose",{data:a}),console.log("addddd",a)},P=()=>{x();const e=(new Date).getTime(),a=j(S.count);w();const t=((new Date).getTime()-e)/1e3;k(`生成${a||S.count}条数据，共耗时${t.toFixed(2)}秒`);const n=T();ve(n),n.flyTo({duration:0,heading:0,pitch:-40,scale:1.2})},V=()=>{T().flyTo({scale:1.2})},F=()=>{L()},J=()=>{Q()},M=()=>{T().show=S.enabledShowHide},I=()=>{const e=T();e.enabledEvent=!1,e.enabledEvent=!0,e.clear(!0),ge.value=[],fe.value=[],n.customEditor?t("onStopEditor"):Y("graphic-editor")},R=()=>{const a=T();if(0===a.length)return void k("当前没有标注任何数据，无需保存！");const t=a.toJSON();e.exports.Util.downloadFile("矢量数据构造参数.json",JSON.stringify(t))},$=()=>{const a=T();if(0===a.length)return void k("当前没有标注任何数据，无需保存！");const t=a.toGeoJSON();e.exports.Util.downloadFile("矢量数据GeoJSON.json",JSON.stringify(t))},z=o(0),B=e=>{z.value++;const a=T(),t=e.file,n=t.name,l=null==n?void 0:n.substring(n.lastIndexOf(".")+1,n.length).toLowerCase();if("json"===l||"geojson"===l){const e=new FileReader;e.readAsText(t,"UTF-8"),e.onloadend=function(e){const t=JSON.parse(this.result);console.log("打开了json文件",t),"graphic"===t.type&&t.data?(a.addGraphic(t.data),a.flyTo()):a.loadGeoJSON(t,{flyTo:!0})}}else if("kml"===l){const e=new FileReader;e.readAsText(t,"UTF-8"),e.onloadend=function(e){const t=this.result,n=/<coordinates>(.*?)<\/coordinates>/g.exec(t);console.log(n,"ressssss"),n[1].split(" "),console.log(n,"strkml"),O.exports.toGeoJSON(t).then((t=>{console.log("kml2geojson转换结果为",t),t=function(a){try{a=C.simplify(a,{tolerance:1e-6,highQuality:!0,mutate:!0})}catch(e){}return a}(t),console.log(t,"geojson"),a.loadGeoJSON(t,{flyTo:!0,style:{clampToGround:!0}})}))}}else"kmz"===l?O.exports.toGeoJSON(t).then((e=>{console.log("kmz2geojson",e),a.loadGeoJSON(e,{flyTo:!0})})):k("暂不支持 "+l+" 文件类型的数据！")},W=o([]),{activate:K,disable:Y,isActivate:Z,updateWidget:pe}=s.exports.useWidget();i((()=>{const a=T();a.on(e.exports.EventType.drawCreated,(function(e){(S.hasEdit||n.customEditor)&&he(e.graphic)})),a.on([e.exports.EventType.editStart,e.exports.EventType.editMovePoint,e.exports.EventType.editStyle,e.exports.EventType.editRemovePoint],(function(e){he(e.graphic)})),a.on([e.exports.EventType.editStop,e.exports.EventType.removeGraphic],(function(e){setTimeout((()=>{a.isEditing||(n.customEditor?t("onStopEditor"):Y("graphic-editor"))}),100)}))}));const he=e=>{n.customEditor===e.type&&t("onStartEditor",{graphicId:e.id,graphicName:xe(e)})},ge=o([]),fe=o([]),me=[{title:"名称",dataIndex:"name",key:"name",align:"center"},{title:"操作",dataIndex:"caozuo",key:"caozuo",width:60,align:"center"}],ye={hideSelectAll:!0,hideDefaultSelections:!0,selectedRowKeys:fe,onChange:e=>{fe.value=e},onSelect:(e,a)=>{const t=T().getGraphicById(e.key);t&&(t.show=a)}};function ve(e){const a=e.graphics;for(let t=a.length-1;t>=0;t--){const e=a[t];e.isPrivate||(ge.value.push({key:e.id,name:xe(e)}),e.show&&fe.value.push(e.id))}}i((()=>{const a=T();ve(a),a.on(e.exports.EventType.addGraphic,(function(e){const a=e.graphic;a.isPrivate||(console.log(a.type,"tyoeeee"),"viewShed"===a.type&&(ge.value.push({key:a.id,name:xe(a)}),fe.value.push(a.id)))})),a.on(e.exports.EventType.removeGraphic,(function(e){const a=e.graphic.id,t=ge.value.findIndex((e=>e.key===a));ge.value.splice(t,1)}))}));let be=0;function xe(e){var a,t;return(null==(t=null==(a=null==e?void 0:e.style)?void 0:a.label)?void 0:t.text)?`${e.type} - ${e.style.label.text}`:e.name+1?`${e.type} - ${e.name}`:e.attr.remark?`${e.type} - ${e.attr.remark}`:(e.name="未命名"+ ++be,`${e.type} - ${e.name}`)}const we=e=>({onClick:()=>{T().getGraphicById(e.key).flyTo()}});return(e,a)=>{const t=c("a-checkbox"),l=c("mars-slider"),o=c("mars-icon"),i=c("mars-button"),s=c("a-space"),x=c("mars-input-number"),w=c("mars-select"),k=c("a-upload"),C=c("mars-table");return d(),r(b,null,[u("div",ee,[p(s,null,{default:h((()=>[ae,p(t,{checked:S.enabledShowHide,"onUpdate:checked":a[0]||(a[0]=e=>S.enabledShowHide=e),onChange:M,title:"显示隐藏状态"},{default:h((()=>[g("显示")])),_:1},8,["checked"]),S.enabledOpacity?(d(),r("span",te,"透明度:")):f("",!0),S.enabledOpacity?(d(),m(l,{key:1,value:S.opacity,"onUpdate:value":a[1]||(a[1]=e=>S.opacity=e),min:0,max:1,step:.1,onChange:A},null,8,["value","min","max","step"])):f("",!0),p(i,{onClick:V,title:"视角定位",size:"small",shape:"round"},{default:h((()=>[p(o,{icon:"aiming",class:"icon-vertical-a"}),g(" 定位 ")])),_:1})])),_:1})]),n.enabledDraw?(d(),r("div",ne,[p(s,null,{default:h((()=>[le,p(i,{onClick:F},{default:h((()=>[g(y(n.drawLabel1),1)])),_:1}),n.drawLabel2?(d(),m(i,{key:0,onClick:J},{default:h((()=>[g(y(n.drawLabel2),1)])),_:1})):f("",!0),p(t,{checked:S.hasTable,"onUpdate:checked":a[2]||(a[2]=e=>S.hasTable=e),title:"显示图层内所有矢量数据列表"},{default:h((()=>[g("显示列表")])),_:1},8,["checked"])])),_:1})])):f("",!0),u("div",oe,[p(s,null,{default:h((()=>[ie,p(x,{min:1,max:1e6,value:S.count,"onUpdate:value":a[3]||(a[3]=e=>S.count=e),step:"1"},null,8,["value"]),g("条 "),p(i,{onClick:P},{default:h((()=>[g("生成")])),_:1}),p(i,{onClick:I},{default:h((()=>[p(o,{icon:"delete",class:"icon-vertical-a"}),g(" 清除 ")])),_:1})])),_:1})]),u("div",se,[p(s,null,{default:h((()=>[ce,p(w,{options:_,onChange:H})])),_:1})]),u("div",de,[p(s,null,{default:h((()=>[re,p(k,{multiple:!1,name:"file",accept:"json,geojson,kml","file-list":W.value,showUploadList:!1,supportServerRender:!0,beforeUpload:()=>!1,onChange:B},{default:h((()=>[p(i,{title:"打开GeoJSON"},{default:h((()=>[p(o,{icon:"folder-open",class:"icon-vertical-a"}),g(" 打开 ")])),_:1})])),_:1},8,["file-list","beforeUpload"]),p(i,{onClick:$,title:"保存GeoJSON"},{default:h((()=>[p(o,{icon:"save-one",class:"icon-vertical-a"}),g(" 导出GeoJSON ")])),_:1}),p(i,{onClick:R,title:"导出构造参数Json"},{default:h((()=>[g(" 导出构造JSON ")])),_:1})])),_:1})]),u("div",ue,[(d(),m(C,{key:0,size:"small",pagination:{pageSize:G.value},customRow:we,"row-selection":ye,dataSource:ge.value,columns:me,scroll:{x:400,y:400},onChange:E,bordered:""},{bodyCell:h((({column:e,record:a})=>["caozuo"===e.key?(d(),m(s,{key:0},{default:h((()=>[p(o,{title:"修改矢量数据样式",icon:"editor",color:"#f2f2f2",class:"icon-vertical-a",onClick:v((e=>function(e){const a=T().getGraphicById(e.key);he(a)}(a)),["stop"])},null,8,["onClick"]),p(o,{title:"删除矢量数据",icon:"delete",color:"#f2f2f2",class:"icon-vertical-a",onClick:v((e=>(e=>{const a=T().getGraphicById(e.key);a&&a.remove(!0)})(a)),["stop"])},null,8,["onClick"])])),_:2},1024)):(d(),r(b,{key:1},[g(y(a.name),1)],64))])),_:1},8,["pagination","dataSource"]))])],64)}}}),[["__scopeId","data-v-48fdd9f5"]]);const he=e=>(S("data-v-660d4216"),e=e(),_(),e),ge={class:"f-mb"},fe=he((()=>u("span",{class:"mars-pannel-item-label"},"水平张角:",-1))),me={class:"f-mb"},ye=he((()=>u("span",{class:"mars-pannel-item-label"},"垂直张角:",-1))),ve={class:"f-mb"},be=he((()=>u("span",{class:"mars-pannel-item-label"},"投射距离:",-1))),xe={class:"f-mb"},we=he((()=>u("span",{class:"mars-pannel-item-label"},"四周方向:",-1))),ke={class:"f-mb"},Ce=he((()=>u("span",{class:"mars-pannel-item-label"},"俯仰角度:",-1))),Se={class:"f-mb"},_e=he((()=>u("span",{class:"mars-pannel-item-label"},"高度:",-1))),Ge={class:"f-mb"},Te=he((()=>u("span",{class:"mars-pannel-item-label"},"视椎框线:",-1))),Ee={class:"f-mb"},Oe=he((()=>u("span",{class:"mars-pannel-item-label"},"视频透明度:",-1))),Ue={class:"f-mb f-tac"};var Ae=t(n({__name:"index",setup(e){U(X);const a=l({showFrustum:!1,cameraAngle:0,cameraAngle2:0,distanceValue:0,heading:0,pitchValue:0,opcity:1,videoRotate:0,graphicName:"",selectedGraphic:!1,addHeightValue:.5}),t=G();function n(e){const t=F(e.graphicId);a.graphicName=e.graphicName,a.cameraAngle=t.angle,a.cameraAngle2=t.angle2,a.distanceValue=t.distance,a.pitchValue=t.pitch,a.opcity=t.opacity,a.heading=t.heading,a.showFrustum=t.showFrustum,a.selectedGraphic=!0}function o(e){console.log("xx",e),P(e)}function i(){a.selectedGraphic=!1}const s=()=>{J()},f=()=>{M(a.cameraAngle)},m=()=>{I(a.cameraAngle2)},y=()=>{R(a.distanceValue)},v=()=>{$(a.addHeightValue)},x=()=>{z(a.heading)},w=()=>{Y()},k=()=>{B(a.pitchValue)},C=()=>{W(a.showFrustum)},S=()=>{K(a.opcity)};return(e,l)=>{const _=c("mars-dialog"),G=c("mars-slider"),O=c("a-space"),U=c("mars-button"),A=c("a-checkbox");return d(),r(b,null,[p(_,T({visible:!0,right:"10",top:"50"},E(t)),{default:h((()=>[p(pe,{defaultCount:10,interaction:!1,customEditor:"viewShed",onOnStartEditor:n,onOnStopEditor:i,onChoose:o})])),_:1},16),p(_,{left:"10",top:"10",title:a.graphicName,visible:a.selectedGraphic,closeable:!0,beforeClose:()=>{a.selectedGraphic=!1}},{default:h((()=>[u("div",ge,[p(O,null,{default:h((()=>[fe,p(G,{onChange:f,value:a.cameraAngle,"onUpdate:value":l[0]||(l[0]=e=>a.cameraAngle=e),min:1,max:60,step:.1},null,8,["value","step"])])),_:1})]),u("div",me,[p(O,null,{default:h((()=>[ye,p(G,{onChange:m,value:a.cameraAngle2,"onUpdate:value":l[1]||(l[1]=e=>a.cameraAngle2=e),min:10,max:45,step:.1},null,8,["value","step"])])),_:1})]),u("div",ve,[p(O,null,{default:h((()=>[be,p(G,{onChange:y,value:a.distanceValue,"onUpdate:value":l[2]||(l[2]=e=>a.distanceValue=e),min:1,max:99999,step:1},null,8,["value"])])),_:1})]),u("div",xe,[p(O,null,{default:h((()=>[we,p(G,{onChange:x,class:"head",value:a.heading,"onUpdate:value":l[3]||(l[3]=e=>a.heading=e),min:0,max:360,step:.1},null,8,["value","step"]),p(U,{onClick:w},{default:h((()=>[g("图上选点")])),_:1})])),_:1})]),u("div",ke,[p(O,null,{default:h((()=>[Ce,p(G,{onChange:k,value:a.pitchValue,"onUpdate:value":l[4]||(l[4]=e=>a.pitchValue=e),min:-180,max:180,step:.1},null,8,["value","step"])])),_:1})]),u("div",Se,[p(O,null,{default:h((()=>[_e,p(G,{onChange:v,value:a.addHeightValue,"onUpdate:value":l[5]||(l[5]=e=>a.addHeightValue=e),min:0,max:180,step:.1},null,8,["value","step"])])),_:1})]),u("div",Ge,[p(O,null,{default:h((()=>[Te,p(A,{onChange:C,checked:a.showFrustum,"onUpdate:checked":l[6]||(l[6]=e=>a.showFrustum=e)},{default:h((()=>[g("是否显示")])),_:1},8,["checked"])])),_:1})]),u("div",Ee,[p(O,null,{default:h((()=>[Oe,p(G,{onChange:S,value:a.opcity,"onUpdate:value":l[7]||(l[7]=e=>a.opcity=e),min:0,max:1,step:.1},null,8,["value","step"])])),_:1})]),u("div",Ue,[p(O,null,{default:h((()=>[p(U,{onClick:s},{default:h((()=>[g("点选相机位置")])),_:1})])),_:1})])])),_:1},8,["title","visible","beforeClose"])],64)}}}),[["__scopeId","data-v-660d4216"]]);export{Ae as default};
