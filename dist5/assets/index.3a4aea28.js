import{a9 as e,_ as o,y as t,Y as a,r as s,aj as n,a as l,G as r,H as i,P as c,a0 as d,d as u,ab as f,as as p,a3 as g,a4 as m}from"./index.3e972bdf.js";import{k as y}from"./kml-geojson-src.9e222f93.js";import{u as h}from"./use-lifecycle.fdbeda11.js";let v,O;function S(){return O}var _=Object.freeze(Object.defineProperty({__proto__:null,get map(){return v},get graphicLayer(){return O},onMounted:function(o){v=o,O=new e.exports.layer.GraphicLayer,v.addLayer(O)},onUnmounted:function(){v.graphicLayer.clear(),v=null},getManagerLayer:S},Symbol.toStringTag,{value:"Module"}));const b=e=>(g("data-v-024ab61e"),e=e(),m(),e),j=b((()=>u("span",{class:"mars-pannel-item-label"},"视域分析:",-1))),J={class:"f-mb"},N=b((()=>u("span",{class:"mars-pannel-item-label"},"数据导出:",-1)));var x=o(t({__name:"index",setup(o){h(_);const{activate:t}=a.exports.useWidget();function g(){return S?S():O}const m=()=>{const o=g();if(0===o.length)return void f("当前没有标注任何数据，无需保存！");const t=o.toJSON();e.exports.Util.downloadFile("矢量数据构造参数.json",JSON.stringify(t))},v=()=>{const o=g();if(0===o.length)return void f("当前没有标注任何数据，无需保存！");const t=o.toGeoJSON();e.exports.Util.downloadFile("矢量数据GeoJSON.json",JSON.stringify(t))},b=s(0),x=e=>{b.value++;const o=g(),t=e.file,a=t.name,s=null==a?void 0:a.substring(a.lastIndexOf(".")+1,a.length).toLowerCase();if("json"===s||"geojson"===s){const e=new FileReader;e.readAsText(t,"UTF-8"),e.onloadend=function(e){const t=JSON.parse(this.result);console.log("打开了json文件",t),"graphic"===t.type&&t.data?(o.addGraphic(t.data),o.flyTo()):o.loadGeoJSON(t,{flyTo:!0})}}else if("kml"===s){const e=new FileReader;e.readAsText(t,"UTF-8"),e.onloadend=function(e){const t=this.result,a=/<coordinates>(.*?)<\/coordinates>/g.exec(t);console.log(a,"ressssss"),a[1].split(" "),console.log(a,"strkml"),y.exports.toGeoJSON(t).then((t=>{console.log("kml2geojson转换结果为",t),t=function(o){try{o=p.simplify(o,{tolerance:1e-6,highQuality:!0,mutate:!0})}catch(e){}return o}(t),console.log(t,"geojson"),o.loadGeoJSON(t,{flyTo:!0,style:{clampToGround:!0}})}))}}else"kmz"===s?y.exports.toGeoJSON(t).then((e=>{console.log("kmz2geojson",e),o.loadGeoJSON(e,{flyTo:!0})})):f("暂不支持 "+s+" 文件类型的数据！")};const G=s([]);return(e,o)=>{const a=n("mars-button"),s=n("a-space"),f=n("mars-icon"),p=n("a-upload"),g=n("mars-dialog");return l(),r(g,{visible:!0,left:"500",top:"15",width:"450px",title:"数据分析"},{default:i((()=>[c(s,{irection:"horizontal"},{default:i((()=>[j,c(a,{onClick:o[0]||(o[0]=e=>{t("Intervisibility")})},{default:i((()=>[d("通视分析")])),_:1}),c(a,{onClick:o[1]||(o[1]=e=>{t("viewshed")})},{default:i((()=>[d("可视域分析")])),_:1})])),_:1}),u("div",J,[c(s,null,{default:i((()=>[N,c(p,{multiple:!1,name:"file",accept:"json,geojson,kml","file-list":G.value,showUploadList:!1,supportServerRender:!0,beforeUpload:()=>!1,onChange:x},{default:i((()=>[c(a,{title:"打开GeoJSON"},{default:i((()=>[c(f,{icon:"folder-open",class:"icon-vertical-a"}),d(" 打开 ")])),_:1})])),_:1},8,["file-list","beforeUpload"]),c(a,{onClick:v,title:"保存GeoJSON"},{default:i((()=>[c(f,{icon:"save-one",class:"icon-vertical-a"}),d(" 导出GeoJSON ")])),_:1}),c(a,{onClick:m,title:"导出构造参数Json"},{default:i((()=>[d(" 导出构造JSON ")])),_:1})])),_:1})])])),_:1})}}}),[["__scopeId","data-v-024ab61e"]]);export{x as default};
