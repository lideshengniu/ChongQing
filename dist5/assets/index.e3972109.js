import{_ as e,y as a,Y as n,p as i,ac as d,r as t,M as s,C as o,aj as c,a as l,G as r,H as p,P as h,U as u,a0 as y,d as f,R as k,S as v,V as x,b as m,K as g}from"./index.3e972bdf.js";import{u as _}from"./use-lifecycle.fdbeda11.js";import{m as b,g as w,a as I}from"./map.852ebca3.js";const O=["onDblclick"],C={key:0,class:"tree-slider"};var K=e(a({__name:"index",setup(e){const{activate:a,disable:K,currentWidget:U}=n.exports.useWidget();i((()=>{T()})),d((()=>{K("layer-tree")})),_(b),U.onUpdate((()=>{W.value=[],E.value=[],Z.value=[],T()}));const W=t([]),E=t([]),Z=t([]),j={},A=s({});let D;const M=(e,n)=>{var i,d,t;const s=j[n.node.id];if(s){if(s.isAdded||I(s),(null==(i=s.options)?void 0:i.radio)&&n.checked)for(const e in j){const a=j[e];Z.value.forEach(((e,n)=>{a===j[e]&&s.pid===j[e].pid&&a!==s&&(Z.value.splice(n,1),a.show=!1)}))}(null==(d=s.options)?void 0:d.onWidget)&&(n.checked?(D&&K(D),a({name:s.options.onWidget}),D=s.options.onWidget):K(s.options.onWidget)),n.node.children&&n.node.children.length&&P(e,n.node.children),-1!==e.indexOf(n.node.id)?(s.show=!0,s.options.noCenter||s.readyPromise.then((function(e){e.flyTo()}))):s.show=!1,(null==(t=s.options)?void 0:t.scenetree)&&G(s)}};function P(e,a){a.forEach((a=>{const n=j[a.id];n&&(n.isAdded||I(n),-1!==e.indexOf(a.id)?n.show=!0:n.show=!1,a.children&&P(e,a.children),n.options.scenetree&&G(n))}))}function T(){const e=w();for(let a=e.length-1;a>=0;a--){const n=e[a];if(n._hasMapInit||-1!==n.pid||99===n.id||(n.pid=99),j[n.id]=n,n&&-1===n.pid){const i=s({index:a,title:n.name||`未命名(${n.type})`,key:n.id,id:n.id,pId:n.pid,hasZIndex:n.hasZIndex,hasOpacity:n.hasOpacity,opacity:100*(n.opacity||0)});n.hasOpacity&&(A[n.id]=100*(n.opacity||0)),i.children=$(i,e),W.value.push(i),!1!==n.options.open&&E.value.push(i.key),n.isAdded&&n.show&&o((()=>{Z.value.push(i.key)}))}}W.value.forEach((e=>{e.children.forEach((e=>{e.children&&e.children.forEach((e=>{j[e.key].options.radio&&(e.parent.disabled=!0)}))}))}))}function $(e,a){return a.filter((a=>a.pid===e.id)).reverse().map(((n,i)=>{const d={index:i,title:n.name||`未命名(${n.type})`,key:n.id,id:n.id,pId:n.pid,hasZIndex:n.hasZIndex,hasOpacity:n.hasOpacity,opacity:100*(n.opacity||0),parent:e};return n.hasOpacity&&(A[n.id]=100*(n.opacity||0)),j[n.id]=n,d.children=$(d,a),!1!==n.options.open&&E.value.push(d.key),n.isAdded&&n.show&&o((()=>{Z.value.push(d.key)})),d}))}function G(e){K("layer-tree"),H&&(H.off("click",R),H=null),e.options.scenetree&&(e.on("click",R),H=e)}let H;function R(e){const n=e.layer,i=n.options.url,d=n.id;a({name:"layer-tree",data:{url:i,id:d}})}return(e,a)=>{const n=c("a-menu-item"),i=c("a-menu"),d=c("mars-dropdown-menu"),t=c("mars-slider"),s=c("mars-tree"),o=c("mars-dialog");return l(),r(o,{draggable:!0,title:"图层",width:"300","min-width":250,top:"100",right:"10"},{default:p((()=>[h(s,{checkable:"","tree-data":W.value,expandedKeys:E.value,"onUpdate:expandedKeys":a[0]||(a[0]=e=>E.value=e),checkedKeys:Z.value,"onUpdate:checkedKeys":a[1]||(a[1]=e=>Z.value=e),onCheck:M},{title:p((e=>[h(d,{trigger:["contextmenu"]},u({default:p((()=>[f("span",{onDblclick:a=>{var n;(n=e).checked&&j[n.id].flyTo()}},k(e.title),41,O)])),_:2},[e.hasZIndex?{name:"overlay",fn:p((()=>[h(i,{onClick:a=>((e,a)=>{const n=e.parent,i=e.index;switch(a){case"1":0!==i&&(n.children[0].index=i,n.children[i].index=0);break;case"2":n.children[i-1].index=i,n.children[i].index=i-1;break;case"3":n.children[i+1].index=i,n.children[i].index=i+1;break;case"4":n.children[n.children.length-1].index=i,n.children[i].index=n.children.length-1}n.children=n.children.sort(((e,a)=>e.index-a.index))})(e,a.key)},{default:p((()=>[h(n,{key:"1"},{default:p((()=>[y("图层置为顶层")])),_:1}),h(n,{key:"2"},{default:p((()=>[y("图层上移一层")])),_:1}),h(n,{key:"3"},{default:p((()=>[y("图层下移一层")])),_:1}),h(n,{key:"4"},{default:p((()=>[y("图层置为底层")])),_:1})])),_:2},1032,["onClick"])])),key:"0"}:void 0]),1024),e.hasOpacity?v((l(),m("span",C,[h(t,{value:A[e.id],"onUpdate:value":a=>A[e.id]=a,min:0,step:1,max:100,onChange:a=>(e=>{const a=e.id,n=j[a];n&&(n.opacity=A[a]/100)})(e)},null,8,["value","onUpdate:value","onChange"])],512)),[[x,e.checked]]):g("",!0)])),_:1},8,["tree-data","expandedKeys","checkedKeys"])])),_:1})}}}),[["__scopeId","data-v-4d556424"]]);export{K as default};
